[
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Sales Order", 
  "modified": "2016-01-11 18:16:08.124992", 
  "name": "Sales Order-Client", 
  "script": "frappe.ui.form.on(\"Sales Order Item\", \"price_list_rate\", function(doc, cdt, cdn){\n  var d = locals[cdt][cdn];\n\n  var price_list = frappe.model.get_value(\"Sales Order Item\", cdn, \"price_list\");\n  if ( price_list == \"\" || ! price_list){\n     frappe.model.set_value(\"Sales Order Item\", cdn, \"price_list_rate\", 0.0);\n     return;\n  }\n\n  var item_code = frappe.model.get_value(\"Sales Order Item\", cdn, \"item_code\");\n  frappe.model.get_value(\"Item Price\", {\n                     \"item_code\": item_code,\n                     \"price_list\": price_list\n                    }, 'price_list_rate', \n                    function(r){\n                         frappe.model.set_value(\"Sales Order Item\", cdn, \"price_list_rate\", r.price_list_rate);\n                    });\n   \n \n  \n  //cur_frm.fields_dict.items.grid.grid_rows_by_docname[cdn].refresh_field('price_list_rate');\n});\n\nfrappe.ui.form.on(\"Sales Order Item\", \"price_list\", function(doc, cdt, cdn){\n       var d = locals[cdt][cdn];\n       frappe.model.trigger(\"price_list_rate\", \n                      frappe.model.get_value(\"Sales Order Item\", cdn, \"price_list_rate\"), d);\n });\n\nfrappe.ui.form.on(\"Sales Order\", \"ignore_pricing_rule\", function(frm){\n \n         var check = cint(frm.doc.ignore_pricing_rule);\n \n         if(check == 1){\n         //alert(check +\" Value ON\");\n         frm.toggle_display(\"selling_price_list\", 0);  \n         frm.toggle_reqd(\"selling_price_list\", false); \n         }\n         else if (check == 0){\n         //child table rule gets hidden or disabled\n         //alert(check +\" Value OF\");\n         frm.toggle_display(\"selling_price_list\", 1);  \n         frm.toggle_reqd(\"selling_price_list\", true); \n         //frappe.meta.get_docfield(\"Sales Order Item\", \"price_list\", this.frm.docname).reqd = false;\n         //frappe.meta.get_docfield(\"Sales order Item\", \"price_list\", this.frm.docname).read_only= 0;\n         }\n });\n\nfrappe.ui.form.on(\"Sales Order\", \"customer\", function(frm) {\n    cur_frm.set_query(\"deal_number\", function() {\n        return {\n            \"filters\": {\n                \"customer_name\": (frm.doc.customer)\n            }\n        };\n    });\n});\n\nfrappe.ui.form.on(\"Sales Order Item\", \"form_render\", function(frm, cdt, cdn){\n field = cur_frm.fields_dict.items.grid.grid_rows_by_docname[cdn].docfields.filter(function(r) {return r.fieldname === 'price_list'; })[0];\n \n     if (cur_frm.doc.ignore_pricing_rule) {\n     field.read_only = false;  \n     field.visible = true;\n     field.reqd = true;\n     cur_frm.fields_dict.items.grid.grid_rows_by_docname[cdn].refresh_field('price_list');\n }\n else {\n     var sellingpl = frm.doc.selling_price_list;\n     frappe.model.set_value(cdt, cdn, \"price_list\", sellingpl);\n     //field.toggle_display = true;\n     //field.reqd = false;\n     //cur_frm.toggle_reqd(\"price_list\", false); \n     //cur_frm.get_field(\"items\").grid.toggle_reqd(\"price_list\", false);\n     //cur_frm.fields_dict.items.grid.grid_rows_by_docname[cdn].refresh_field('price_list');\n     field.read_only = true;\n     cur_frm.fields_dict.items.grid.grid_rows_by_docname[cdn].refresh_field('price_list');\n }\n \n \n });", 
  "script_type": "Client"
 }
]