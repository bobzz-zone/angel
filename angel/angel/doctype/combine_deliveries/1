frappe.provide('frappe.msgprint');
frappe.provide('frappe._');
$.extend(cur_frm.cscript, {

"get_items" : function(doc, cdt ,cdn){
		var me = this;
		var customer_terr = doc.cust_and_terr || [];
		var lst = {};
		var customer =[];
		var territory =[];
		if(customer_terr.length ==0){
			msgprint(frappe._("Please add atleast one filter"));
			return
		}
		else{
			for(var i=0; i<customer_terr.length; i++){
				customer.push(customer_terr[i].customer);
				territory.push(customer_terr[i].territory);	
			}
			lst.customer = customer;
			lst.territory = territory;
		}
		frappe.call({
			method: "angel.angel.doctype.combine_deliveries.combine_deliveries.get_delivery_note",
			args : {"data":lst},
			callback: function(r){
				if(r && r.message){
					var parent_doc = frappe.model.get_doc("Combine Deliveries", doc.name);
					var data = r.message || [];
					for(var i=0;i<data.length;i++){
						var child_doc = frappe.model.get_new_doc("Combine Delivery Item", parent_doc, "result_table");
						$.extend(child_doc, {
							"delivery_note_number": data[i]
						});
					}
				}
			}
		});
		me.refresh();
		
}
});
